(function(a){a.fn.GhostNextPost=function(c){var e=a(window),d=a(document.body),b=a(this),f=a.Deferred();if(Modernizr.sessionstorage&&sessionStorage.getItem("rss")){f.resolve(a.parseXML(sessionStorage.getItem("rss")))}else{a.ajax({url:"/rss",dataType:"text"}).done(function(g){f.resolve(a.parseXML(g));if(Modernizr.sessionstorage){sessionStorage.setItem("rss",g)}})}f.done(function(j){var k=document.createElement("a"),i=a(j),g=i.find("item link").filter(function(){k.href=a(this).text();return k.pathname===location.pathname}).parent().next("item").find("link");if(g.length){k.href=g.text();var h=k.pathname;a.ajax(h).done(function(o){var m=a("<div></div>").html(o),l=m.find(".post"),q=l.find(".post-title").html(),n=l.find(".post-content").html();if(l.length){var p=a(Handlebars.compile(c)({id:l.attr("id").replace("post-",""),title:q,url:h,content:n}));p.insertAfter(b)}})}})}})(jQuery);